<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>SwayMini Resource Library</title>
    <script type="text/javascript" src="../../static/js/jquery.min.js"></script>
    <script type="text/javascript" src="../../static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../static/js/jquery.ui.widget.js"></script>
    <script type="text/javascript" src="../../static/js/jquery.iframe-transport.js"></script>
    <script type="text/javascript" src="../../static/js/jquery.fileupload.js"></script>
    <link rel="stylesheet" type="text/css" href="../../static/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" media="all" href="../../static/css/base.css" >
    <link rel="stylesheet" type="text/css" media="all" href="../../static/css/index.css" >

    <style>

        .center-1 {
            margin:auto;
            width:30%;
            background-color:#c0c0c0;
        }

        .bar {
            height: 18px;
            background: green;
        }

        .video-container {
            position: relative;
            padding-bottom: 56.25%; <!--16:9-->
            padding-top: 1px;
            height: 0;
            overflow: hidden;
        }

        .video-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .audio-container {
            position: relative;
            padding-bottom: 10%; <!--16:9-->
            padding-top: 3px;
            height: 0;
            overflow: hidden;
        }

        .audio-container audio {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

    </style>
</head>

<body>
<nav class="navbar navbar-default" role="navigation">
    <div>
        <ul class="nav navbar-nav navbar-right"  style="margin-right: 0px">
            <li>
                <a href="/home/" id="userName">{{ username }}
                </a>
            </li>
        </ul>
        <ul class="nav navbar-nav navbar-left">
            <li>
                <a href="#" role="button" class="btn" onclick="upload()">Upload Files</a>
            </li>
        </ul>
    </div>
</nav>

<div class="container" id="showRes">

</div>

</body>
</html>

<script>

    var loadingBlockNum = 0;


    function getResPostfix(fname) {
        if (fname.indexOf('.')!=-1) {
            var postfix = fname.substring(fname.lastIndexOf('.') + 1, fname.length);
            var supportedFormats = ["jpeg", "jpg", "png", "gif",
                    "wav", "mp3", "mp4", "webm", "ogg"];
            if (supportedFormats.indexOf(postfix)!=-1) {
                return postfix;
            }
        }
        return "."; //wrong type or file name does not have a postfix
    }

    function getResType(fname) {
        var imgFormat = new Array("jpeg", "jpg", "png", "gif");
        var audioFormat = new Array("wav", "mp3");
        var videoFormat = new Array("webm", "mp4", "ogg"); //treat ogg as video
        var postfix = getResPostfix(fname);
        if (postfix==".") {
            return -1; //wrong
        }
        //return val 0 is empty, for it is text type
        else if (imgFormat.indexOf(postfix)!=-1) {
            return 1;
        }
        else if (audioFormat.indexOf(postfix)!=-1) {
            return 2;
        }
        else if (videoFormat.indexOf(postfix)!=-1) {
            return 3;
        }
        else {
            console.log("???");
        }
    }

    {% for f in fnames %}
        $(function() {
            if (loadingBlockNum % 4 == 0) { //start of a new row
                var new_row = $("<div class='row'></div>")
                        .attr("id", "row-" + loadingBlockNum/4);
                for (var idx=0; idx<4; idx++) { //4 cols in one row
                    var col_num = loadingBlockNum + idx;
                    var new_col = $("<div></div>")
                            .attr("class", "col-sm-3")
                            .attr("id", "col-"+col_num)
                            .css("background-color", "#ffffff"); //white
                    //.css("box-shadow", "inset 1px -1px 1px #444, inset -1px 1px 1px #444")
                    new_row.append(new_col);
                }
                $("#showRes").append(new_row);
            }
            //end of create new row and 4 cols in it
            var res_url = "../../static/data/{{ username }}/res/{{ f }}/";
            var format = getResPostfix("{{ f }}");
            var block = $("#col-"+loadingBlockNum);
            switch (getResType("{{ f }}")) {
                case 1: {
                    var thumbnail = $("<div class=\"thumbnail\"></div>");
                    var img = $("<img src=\"" + res_url + "\" class=\"img-responsive img-rounded\">");
                    thumbnail.append(img);
                    block.append(thumbnail);
                }
                    break;
                case 2: {
                    var audWrap = $("<div class=\"audio-container\"></div>");
                    var audCtrl = $("<audio controls> 您的浏览器不支持audio元素 </audio>");
                    var audSrc = $("<source src=\"" + res_url + "\" type=\"audio/"+format+"\">");
                    audCtrl.append(audSrc);
                    audWrap.append(audCtrl);
                    block.append(audWrap);
                }
                    break;
                case 3: {
                    var vidWrap = $("<div class=\"video-container\"></div>");
                    var vidCtrl = $("<video controls> 您的浏览器不支持video元素 </video>");
                    var vidSrc = $("<source src=\"" + res_url + "\" type=\"video/"+format+"\">");
                    vidCtrl.append(vidSrc);
                    vidWrap.append(vidCtrl);
                    block.append(vidWrap);
                }
                    break;
                default: {
                    return;
                }
            }
            loadingBlockNum++;
            var fname = "{{ f }}";
            var h4span = $("<h4><span class=\"label label-info\">"+fname+"</span></h4>");
            //var filename = $("<div></div>");
            //filename.attr("class", "container");
            //filename.attr("align", "center");
            //filename.append(h3span);
            block.append(h4span);
        });
    {% endfor %}

</script>